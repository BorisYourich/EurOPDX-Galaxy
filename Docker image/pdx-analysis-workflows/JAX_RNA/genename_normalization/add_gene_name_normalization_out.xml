<tool id="addname_and_normalization" name="Add GeneName and Normalization" version="1.0.0">
    <description>to RSEM isoformsresults</description>
    <requirements>
        <requirement type="package" version="3.6.1">r-base</requirement>
    </requirements>

    <command detect_errors="exit_code">
        <![CDATA[#import os
            perl '${__tool_directory__}/GeneName_and_Normalization_without_UCSC.pl'
            #if $qual.add == "paired_collection"
                -i1 "${qual.in_collection.genes}" -i2 "${qual.in_collection.isoforms}" -a1 $in_3
            #else
                -i1 "$qual.in_1" -i2 "$qual.in_2" -a1 $in_3
            #end if
        ]]>
    </command>
    <inputs>
        <conditional name="qual">
            <param name="add" type="select" label="Input Type">
                <option value="single_dataset">Single sample</option>
                <option value="paired_collection" selected="true">Samples collection</option>
            </param>
            <when value="single_dataset">
                <param format="tabular" name="in_1" type="data" label="RSEM Alignment Genes Results"
                       help="This file is generated by RSEM Alignment tool."/>
                <param format="tabular" name="in_2" type="data" label="RSEM Alignment Isoforms Results"
                       help="This file is generated by RSEM Alignment tool."/>
            </when>
            <when value="paired_collection">
                <param name="in_collection" type="data_collection" collection_type="list"
                       label="Select RSEM Alignment (Genes, Isoforms and Sorted genome) Collection"/>
            </when>
        </conditional>
        <param format="tabular" name="in_3" type="data" label="Namesgene File"
               help="Downloaded from https://www.ensembl.org/index.html (See tool description for more information about this input). And uploaded to the galaxy as a dataset."/>
    </inputs>
    <outputs>
        <!-- Single-sample output -->
        <data name="out_1" format="tabular" from_work_dir="gene.Normalized" label="Genes Normalized Results">
            <filter>qual['add'] == 'single_dataset'</filter>
        </data>
        <data name="out_2" format="tabular" from_work_dir="gene.withGeneName" label="Genes with GeneName">
            <filter>qual['add'] == 'single_dataset'</filter>
        </data>
        <data name="out_3" format="tabular" from_work_dir="isoform.Normalized" label="Isoforms Normalized Results">
            <filter>qual['add'] == 'single_dataset'</filter>
        </data>
        <data name="out_4" format="tabular" from_work_dir="isoform.withGeneName" label="Isoforms with GeneName">
            <filter>qual['add'] == 'single_dataset'</filter>
        </data>

        <!-- Multiple sample output -->
        <collection name="list_output" type="list" label="Gene Name Normalization">
            <data name="genewithgenename" format="tabular" from_work_dir="gene.withGeneName" hidden="true"/>
            <data name="genenormalized" format="tabular" from_work_dir="gene.Normalized" hidden="true"/>
            <data name="isoformswithgenename" format="tabular" from_work_dir="isoform.withGeneName" hidden="true"/>
            <data name="isoformsnormalized" format="tabular" from_work_dir="isoform.Normalized" hidden="true"/>
            <filter>qual['add'] == 'paired_collection'</filter>
        </collection>
    </outputs>

    <help>
        This tool has following input and output files.

        Inputs:

        1) Input Type:

            Samples collection: RSEM Alignment Genes and Isoforms Collection that is generated by RSEM Alignment tool.

            Single sample: RSEM Alignment Genes Results and Isoforms Results that are generated by RSEM Alignment tool.

        2) Namesgene File: Go to https://www.ensembl.org/index.html, on the upper panel there is tool Biomart. There you chose database Ensembl Genes 99 and afterwards Human Genes. In the left menu under Attributes, select just valid columns (Gene stable ID, Transcript stable ID, Gene name, Transcript name) in the same order. Then in the upper left there is Results where you can export into a tsv file. This will create a file of all Ensembl genes with all attributes you select.

        Outputs:

        Based on the input selection, one of the following will be output.

        1) Samples collection: Gene Name Normalization Collection.

        2) Single sample: Genes Normalized Results, Genes with GeneName, Isoforms Normalized Results and Isoforms with GeneName.
    </help>
</tool>
