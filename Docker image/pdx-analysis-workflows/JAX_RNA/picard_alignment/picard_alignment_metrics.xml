<tool id="picard_alignment" name="PICARD Alignment" version="1.2.0">
    <description>metrics</description>
    <requirements>
        <requirement type="package" version="3.6.1"> r-base </requirement>
        <requirement type="package" version="2.21.8"> picard </requirement>
        <requirement type="package" version="1.3"> samtools </requirement>
        <requirement type="binary">java</requirement>
    </requirements>

    <command detect_errors="exit_code">
        <![CDATA[
            python3 '${__tool_directory__}/picard_alignment_metrics.py'
            #if $qual.add == "paired_collection"
                "${qual.in_1.genome}" $in_2 $in_3 "${qual.in_1.element_identifier}"
                && mv "${qual.in_1.element_identifier}"_picard_stat "$stats"
            #else
                "$qual.in_1" $in_2 $in_3 "$qual.in_1.element_identifier"
                && mv "single_picard_stat" "$stats"
            #end if

            #if $qual.add == "paired_collection"
                && ls -la
            #end if
        ]]>
    </command>
    <inputs>
        <param format="tabular" name="in_2" type="data" label="Reference Flat" help=""/>
        <param format="fasta" name="in_3" type="data" label="Reference Sequence" help="Downloaded from ftp://ftp.ensembl.org/pub/release-99/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz. And uploaded to the galaxy as a dataset"/>
        <conditional name="qual">
            <param name="add" type="select" label="Input Type">
                <option value="single_dataset">Single sample</option>
                <option value="paired_collection" selected="true">Samples collection</option>
            </param>
            <when value="single_dataset">
                <param format="bam" name="in_1" type="data" label="Select RSEM Alignment BAM"/>
            </when>
            <when value="paired_collection">
                <param name="in_1" type="data_collection" collection_type="list" label="Select RSEM Alignment BAM"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_1"  format="bam" from_work_dir="genome_bam_read_group_reorder_sorted.bam" label="PICARD Sorted File"/>
        <data name="stats"  format="txt" label="PICARD Statistics"/>
    </outputs>

    <help>
        This tool generates Alignment metrics using PICARD followed by the compilation of all metrics (e.g., statistics from filtering, RSEM, and PICARD). This tool has following input and output files.

        Inputs:

        1) Input Type:

            Samples collection: RSEM Alignment Collection that is generated by RSEM Alignment tool.

            Single sample: RSEM Alignment BAM that is generated by RSEM Alignment tool.

        2) Reference Flat: This file is generated by Create Reference Flat tool.

        3) Reference Sequence: Downloaded from ftp://ftp.ensembl.org/pub/release-99/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.primary_assembly.fa.gz. And uploaded to the galaxy as a dataset.

        Outputs:

        Based on the input selection, one of the following will be output.

        1) Samples collection: GeneName Normalization Collection.

        2) Single sample: BAM Sorted Dataset and Summary Metrics File.
    </help>
</tool>

