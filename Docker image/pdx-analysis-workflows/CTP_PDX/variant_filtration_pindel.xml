<tool id="variant_filtration_pindel" name="Variant Filtration Pindel" version="0.0.0">
    <description>tool</description>
    <requirements>
        <requirement type="package" version="4.3.1t"> snpsift </requirement>
        <requirement type="package" version="0.2.6">tabix</requirement>
    </requirements>
    <stdio>
         <exit_code range="1:" level="fatal" />
    </stdio>
    <command>
        <![CDATA[
            #set vcf1='DPfiltered_microindels.tmp.vcf'
            #set vcf2='additionalfilters.tmp.vcf'
            #set vcf_out='microIndels.DPfiltered.vcf'
	    #if $input.type == "single_dataset"
		python '${__tool_directory__}/bin/allele_depth_min_and_AF_from_ADs.py' ${input.in_1} $vcf1 140
	    #else
		python '${__tool_directory__}/bin/allele_depth_min_and_AF_from_ADs.py' ${input.in_1.microIndels_DP} $vcf1 140
	    #end if
	    && SnpSift -Xmx8G annotate -id "/mnt/volume/shared/ext-data-library/CTP-seq/Homo_sapiens_assembly38.dbsnp138.vcf" $vcf1 > $vcf2 &&
            sh '${__tool_directory__}/bin/caller_add_pindel.sh' $vcf2 $vcf_out
        ]]>
    </command>
    <inputs>
        <conditional name="input">
            <param name="type" type="select" label="Input Type">
                <option value="single_dataset" selected="true">Single (Sample)</option>
                <option value="sample_collection" >Collection (Multiple Samples)</option>
            </param>
            <when value="single_dataset">
                <param format="vcf" name="in_1" type="data" label="MicroIndels DPfiltered 1"
                       help="This dataset is generated by MicroIndel Calling tool."/>
            </when>
            <when value="sample_collection">
                <param name="in_1" type="data_collection" collection_type="list"
                       label="Select MicroIndels DPfiltered 1 Collection"
                       help="Specify MicroIndels DPfiltered 1 dataset collection."/>
            </when>
        </conditional>
	<param format="txt" name="in_2" type="hidden" label="static" value="static"/>
    </inputs>
    <outputs>
        <data name="out_1" format="vcf" from_work_dir="microIndels.DPfiltered.vcf" label="MicroIndels DPFiltered 2">
             <filter>input['type'] == 'single_dataset'</filter>
        </data>

        <collection name="list_output" type="list" label="Microindels DPfiltered Collection">
            <data name="DPfiltered" format="vcf" from_work_dir="microIndels.DPfiltered.vcf" hidden="true"/>
	    <data name="static" format_source="in_2" hidden="true"/>
	    <filter>input['type'] == 'sample_collection'</filter>
        </collection>
    </outputs>

    <help>
        Filter variants with DP less than 140, call variant effects with vep.

        This tool has following input and output dataset or collections.

        Inputs:

        1) Input Type:

            Dataset Collection (Multiple samples): MicroIndels DPfiltered 1 (VCF) Collection. Generated by MicroIndel Calling tool.

            Single Dataset (Single sample): MicroIndels DPfiltered 1 (VCF) Dataset. Generated by MicroIndel Calling tool.

        2) Homo_sapiens_assembly38.dbsnp138.vcf

        Outputs:

        Based on the input selection, following will be output(s).

        1) MicroIndels DPfiltered 2 (VCF)

    </help>
</tool>
